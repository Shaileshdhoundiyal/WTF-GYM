<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WTF GYM â€” AI Fitness Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet" />
    <style>
      * { box-sizing: border-box; margin: 0; padding: 0; }

      html, body {
        height: 100%; width: 100%;
        font-family: 'Inter', sans-serif;
        background: #0a0a0a;
        color: #e0e0e0;
        display: flex; flex-direction: column;
      }

      /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      header {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        padding: 16px 24px;
        display: flex; align-items: center; gap: 14px;
        border-bottom: 2px solid #e94560;
        box-shadow: 0 4px 20px rgba(233, 69, 96, 0.15);
      }

      .logo {
        font-size: 28px; font-weight: 900;
        background: linear-gradient(135deg, #e94560, #ff6b6b);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        letter-spacing: 2px;
      }

      .tagline {
        font-size: 13px; color: #8892b0; font-weight: 400;
      }

      .status-dot {
        width: 10px; height: 10px; border-radius: 50%;
        background: #555; margin-left: auto;
        transition: background 0.3s;
      }
      .status-dot.connected { background: #00e676; box-shadow: 0 0 8px #00e676; }

      /* â”€â”€ Messages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      #messages {
        flex: 1; overflow-y: auto; padding: 24px 20px;
        display: flex; flex-direction: column; gap: 12px;
        background: #0d0d0d;
      }

      #messages::-webkit-scrollbar { width: 6px; }
      #messages::-webkit-scrollbar-track { background: transparent; }
      #messages::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }

      .message {
        padding: 12px 16px; border-radius: 16px;
        max-width: 80%; word-wrap: break-word;
        font-size: 14px; line-height: 1.5;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(8px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .user {
        background: linear-gradient(135deg, #e94560, #c0392b);
        color: #fff; align-self: flex-end;
        border-bottom-right-radius: 4px;
      }

      .ai {
        background: #1a1a2e; color: #ccd6f6;
        align-self: flex-start;
        border: 1px solid #233554;
        border-bottom-left-radius: 4px;
      }

      .welcome {
        text-align: center; color: #555; font-size: 13px;
        padding: 40px 20px; align-self: center;
      }
      .welcome span { font-size: 40px; display: block; margin-bottom: 8px; }

      /* â”€â”€ Typing indicator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .typing { display: none; align-self: flex-start; padding: 10px 16px; }
      .typing.show { display: flex; gap: 4px; align-items: center; }
      .typing-dot {
        width: 7px; height: 7px; background: #e94560; border-radius: 50%;
        animation: bounce 1.4s infinite ease-in-out;
      }
      .typing-dot:nth-child(2) { animation-delay: 0.2s; }
      .typing-dot:nth-child(3) { animation-delay: 0.4s; }
      @keyframes bounce {
        0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
        40% { transform: scale(1); opacity: 1; }
      }

      /* â”€â”€ Input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      form {
        display: flex; padding: 16px 20px; gap: 10px;
        background: #111; border-top: 1px solid #222;
      }

      input {
        flex: 1; padding: 14px 18px;
        background: #1a1a2e; border: 1px solid #233554;
        border-radius: 12px; color: #ccd6f6;
        font-size: 14px; font-family: 'Inter', sans-serif;
        outline: none; transition: border 0.2s;
      }
      input:focus { border-color: #e94560; }
      input::placeholder { color: #555; }

      button {
        padding: 14px 24px; border: none;
        background: linear-gradient(135deg, #e94560, #c0392b);
        color: #fff; font-size: 14px; font-weight: 600;
        border-radius: 12px; cursor: pointer;
        font-family: 'Inter', sans-serif;
        transition: transform 0.15s, box-shadow 0.2s;
      }
      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
      }
      button:active { transform: translateY(0); }

      /* â”€â”€ Markdown-ish formatting â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .ai strong, .ai b { color: #e94560; }
    </style>
  </head>
  <body>

    <header>
      <div class="logo">WTF GYM</div>
      <div class="tagline">AI Fitness Assistant ğŸ’ª</div>
      <div class="status-dot" id="statusDot"></div>
    </header>

    <div id="messages">
      <div class="welcome">
        <span>ğŸ‹ï¸</span>
        Ask me about workouts, diet plans, or gym myths!
      </div>
    </div>

    <div class="typing" id="typing">
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
    </div>

    <form id="form">
      <input id="message" type="text" placeholder="Ask anything about fitness..." autocomplete="off" />
      <button type="submit">Send</button>
    </form>

    <script>
      // â”€â”€ WebSocket URL (auto-detects local vs production) â”€â”€
      const WS_URL = window.location.hostname === "localhost"
        ? "ws://localhost:8001/ws"
        : `wss://${window.location.host}/ws`;

      const ws = new WebSocket(WS_URL);
      const statusDot = document.getElementById("statusDot");
      const typingIndicator = document.getElementById("typing");

      ws.onopen = () => {
        console.log("âœ… Connected to WTF GYM");
        statusDot.classList.add("connected");
      };

      ws.onmessage = (event) => {
        typingIndicator.classList.remove("show");
        const data = JSON.parse(event.data);
        if (data.response) {
          appendMessage("ai", data.response);
        } else if (data.error) {
          appendMessage("ai", "âš ï¸ " + data.error);
        }
      };

      ws.onclose = () => {
        statusDot.classList.remove("connected");
        console.log("âŒ Disconnected");
      };

      const form = document.getElementById("form");
      const input = document.getElementById("message");

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const msg = input.value.trim();
        if (!msg || ws.readyState !== WebSocket.OPEN) return;

        // Remove welcome message
        const welcome = document.querySelector(".welcome");
        if (welcome) welcome.remove();

        appendMessage("user", msg);
        ws.send(JSON.stringify({ message: msg }));
        input.value = "";
        typingIndicator.classList.add("show");
      });

      function appendMessage(type, text) {
        const container = document.getElementById("messages");
        const div = document.createElement("div");
        div.classList.add("message", type);

        // Basic markdown: **bold**, \n â†’ <br>
        let html = text
          .replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
          .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
          .replace(/\n/g, "<br>");

        div.innerHTML = type === "user"
          ? html
          : `<span style="color:#e94560;font-weight:600;">WTF GYM:</span> ${html}`;

        container.appendChild(div);
        container.scrollTop = container.scrollHeight;
      }
    </script>
  </body>
</html>
